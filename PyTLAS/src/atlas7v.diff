--- /dev/fd/63	2025-11-26 01:52:56.798134812 -0500
+++ /dev/fd/62	2025-11-26 01:52:56.798134812 -0500
@@ -6,6 +6,9 @@
 C     revised 31jul04
       IMPLICIT REAL*8 (A-H,O-Z)
       PARAMETER (kw=99)
+
+      INTEGER IF5LINE,IF2LINE
+
       COMMON /ABROSS/ABROSS(kw),TAUROS(kw)
       COMMON /ABTOT/ABTOT(kw),ALPHA(kw)
       COMMON /BAL/BAL1(kw,9),AAL1(kw),SAL1(kw),XNFPAL(kw,2),BAL2(kw,1)
@@ -1402,12 +1405,15 @@
      1 140,1842,18085,26373,4172,4173,19231,583,102,8427,584,435/
       EXP10(X)=EXP(X*2.30258509299405D0)
       CARD81=BLANK
+      IF5LINE=0
       LAST=81
       MAXPOW=38
    98 MORE=0
       LETCOL=1
-   99 READ(5,1) CARD
-    1 FORMAT(80A1)
+c   99 READ(5,1) CARD
+c    1 FORMAT(80A1)
+      IF5LINE=IF5LINE+1
+   99 CALL loadf5(IF5LINE,CARD)
 C     (M)ACHINE (I)NDEPENDENT (A)LPHAMERIC (C)ODE
 C     BASE 37    A=1, Z=26, 0=27, 9=36
       MIAC=IWORDF(CARD)
@@ -1653,7 +1659,9 @@
  1120 NRHOX=FREEFF(CARD)
       DO 1122 J=1,NRHOX
       NUMCOL=1
-      READ(5,1)CARD
+c      READ(5,1)CARD
+      IF5LINE=IF5LINE+1
+      CALL loadf5(IF5LINE,CARD)
       DUMMY=FREEFF(CARD)
       DO 1121 I=1,6
  1121 BHYD(J,I)=FREEFF(CARD)
@@ -1664,7 +1672,8 @@
  1130 NRHOX=FREEFF(CARD)
       DO 1131 J=1,NRHOX
       NUMCOL=1
-      READ(5,1)CARD
+      IF5LINE=IF5LINE+1
+      CALL loadf5(IF5LINE,CARD)
       TAUROS(J)=FREEFF(CARD)
  1131 T(J)=FREEFF(CARD)
       IF(TAUROS(1).GT.0.)GO TO 702
@@ -1674,7 +1683,8 @@
  1140 NRHOX=FREEFF(CARD)
       DO 1141 J=1,NRHOX
       NUMCOL=1
-      READ(5,1)CARD
+      IF5LINE=IF5LINE+1
+      CALL loadf5(IF5LINE,CARD)
       RHOX(J)=FREEFF(CARD)
       T(J)=FREEFF(CARD)
       MORE=1
@@ -1692,7 +1702,8 @@
       PCON=0.
       PZER0=PCON+PRADK0+PTURB0
       IF(MIAC.NE.7754456)GO TO 98
-      READ(5,1)CARD
+      IF5LINE=IF5LINE+1
+      CALL loadf5(IF5LINE,CARD)
       NUMCOL=1
       PRADK0=FREEFF(CARD)
       DO 1144 J=1,NRHOX
@@ -1703,7 +1714,8 @@
       GO TO 98
  1150 NLTEON=1
       WLTE=WWNLTE
- 1151 READ(5,1)CARD
+      IF5LINE=IF5LINE+1
+ 1151 CALL loadf5(IF5LINE,CARD)
       MORE=0
       LETCOL=1
       MIAC=IWORDF(CARD)
@@ -1954,10 +1966,10 @@
       DO 1511 IZ=3,99
       IF(ABUND(IZ).GT.0.)ABUND(IZ)= LOG10(ABUND(IZ))
  1511 CONTINUE
-      WRITE(6,1512)TEFF,GLOG,WLTE,TITLE,XSCALE,
-     1(ELEM(IZ),ABUND(IZ),IZ=1,99)
- 1512 FORMAT(1H1/////5H TEFF,F7.0,8H   LOG G,F8.4,3X,A4/
-     17H0TITLE ,74A1/7H0XSCALE,F10.6,2(3X,A2,F8.5)/(10(1X,A2,F6.2)))
+c      WRITE(6,1512)TEFF,GLOG,WLTE,TITLE,XSCALE,
+c     1(ELEM(IZ),ABUND(IZ),IZ=1,99)
+c 1512 FORMAT(1H1/////5H TEFF,F7.0,8H   LOG G,F8.4,3X,A4/
+c     17H0TITLE ,74A1/7H0XSCALE,F10.6,2(3X,A2,F8.5)/(10(1X,A2,F6.2)))
 C1512 FORMAT(1H1/////5H TEFFF7.0,8H   LOG GF6.2,3XA4/
 C    17H0TITLE ,74A1/7H0XSCALEF8.3,2(3X,A2,F6.3)/(10(1XA2,F6.2)))
       DO 1513 IZ=3,99
@@ -1976,16 +1988,16 @@
       XNATOM(J)=P(J)/TK(J)-XNE(J)
       RHO(J)=XNATOM(J)*WTMOLE*1.660D-24
  1516 PTURB(J)=.5*RHO(J)*VTURB(J)**2
-      WRITE(6,1517)IFOP
- 1517 FORMAT(3H0H1I2,7H H2PLUSI2,7H HMINUSI2,5H HRAYI2,4H HE1I2,
-     1 4H HE2I2,8H HEMINUSI2,6H HERAYI2,5H COOLI2,5H LUKEI2/
-     2 4H HOTI2,9H ELECTRONI2,6H H2RAYI2,7H HLINESI2,6H LINESI2,
-     3 9H LINESCATI2,7H XLINESI2,7H XLSCATI2,6H XCONTI2,6H XSCATI2)
-      WRITE(6,1518)IFCORR,IFPRES,IFSURF,IFSCAT,IFCONV,MIXLTH,IFMOL,
-     1IFTURB,TRBFDG,TRBPOW,TRBSND,TRBCON
- 1518 FORMAT(7H0IFCORRI2,8H  IFPRESI2,8H  IFSURFI2,8H  IFSCATI2,
-     1 8H  IFCONVI2,8H  MIXLTHF6.2,7H  IFMOLI2/7H IFTURBI2,
-     2 8H  TRBFDGF6.2,8H  TRBPOWF6.2,8H  TRBSNDF6.2,8H  TRBCONF6.2)
+c      WRITE(6,1517)IFOP
+c 1517 FORMAT(3H0H1I2,7H H2PLUSI2,7H HMINUSI2,5H HRAYI2,4H HE1I2,
+c     1 4H HE2I2,8H HEMINUSI2,6H HERAYI2,5H COOLI2,5H LUKEI2/
+c     2 4H HOTI2,9H ELECTRONI2,6H H2RAYI2,7H HLINESI2,6H LINESI2,
+c     3 9H LINESCATI2,7H XLINESI2,7H XLSCATI2,6H XCONTI2,6H XSCATI2)
+c      WRITE(6,1518)IFCORR,IFPRES,IFSURF,IFSCAT,IFCONV,MIXLTH,IFMOL,
+c     1IFTURB,TRBFDG,TRBPOW,TRBSND,TRBCON
+c 1518 FORMAT(7H0IFCORRI2,8H  IFPRESI2,8H  IFSURFI2,8H  IFSCATI2,
+c     1 8H  IFCONVI2,8H  MIXLTHF6.2,7H  IFMOLI2/7H IFTURBI2,
+c     2 8H  TRBFDGF6.2,8H  TRBPOWF6.2,8H  TRBSNDF6.2,8H  TRBCONF6.2)
       IF(MODE.NE.1)GO TO 1575
       WRITE(6,1521)NUMITS,IFPRNT,IFPNCH
  1521 FORMAT(7H NUMITSI3,8H  IFPRNT15I2,8H  IFPNCH15I2)
@@ -2009,12 +2021,12 @@
 C1564 FORMAT((3(3XI3,0P2E13.6)))
 C
  1575 CONTINUE
-      WRITE(6,1576)(J,RHOX(J),T(J),P(J),XNE(J),ABROSS(J),PRAD(J),
-     1VTURB(J),(BHYD(J,I),I=1,6),BMIN(J),J=1,NRHOX)
- 1576 FORMAT(1H1/////8X4HRHOX,9X1HT,8X1HP,8X3HXNE,6X6HABROSS,5X4HPRAD,
-     1 6X5HVTURB,24X4HBHYD,25X4HBMIN/
+c      WRITE(6,1576)(J,RHOX(J),T(J),P(J),XNE(J),ABROSS(J),PRAD(J),
+c     1VTURB(J),(BHYD(J,I),I=1,6),BMIN(J),J=1,NRHOX)
+c 1576 FORMAT(1H1/////8X4HRHOX,9X1HT,8X1HP,8X3HXNE,6X6HABROSS,5X4HPRAD,
+c     1 6X5HVTURB,24X4HBHYD,25X4HBMIN/
 C    2(I3,0PE13.6,0PF9.1,0P5E10.3,1X0P7F8.4))
-     2(I3,1PE13.6,0PF9.1,1P5E10.3,1X0P7F8.4))
+c     2(I3,1PE13.6,0PF9.1,1P5E10.3,1X0P7F8.4))
 C
       RETURN
 C************
@@ -2888,6 +2900,10 @@
       COMMON /XNMOL/CODEMOL(MAXMOL),XNMOL(kw,MAXMOL),
      1              XNFPMOL(kw,MAXMOL),NUMMOL
       DATA ITEMP1/0/
+      IF (MODE.EQ.-100) THEN
+      ITEMP1=0
+      RETURN
+      ENDIF
       IF(IFMOL.EQ.1)GO TO 200
       IF(IFPRES.EQ.1.AND.ITEMP.NE.ITEMP1)CALL NELECT
       ITEMP1=ITEMP
@@ -2994,8 +3010,8 @@
       DO 401 I=1,NZ
       NELEM=NELEMZ(I)
   401 EL(I)=ELEM(NELEM)
-      WRITE(6,402)(EL(I),I=1,NZ),(EL(I),I=1,NZ)
-  402 FORMAT(1H1////50X22HELECTRON CONTRIBUTIONS/2X,20(4X,A2))
+c      WRITE(6,402)(EL(I),I=1,NZ),(EL(I),I=1,NZ)
+c  402 FORMAT(1H1////50X22HELECTRON CONTRIBUTIONS/2X,20(4X,A2))
   406 XNE(1)=P(1)/TK(1)/2.
       DO 500 J=1,NRHOX
       IF(J.GT.1)XNE(J)=XNE(J-1)*P(J)/P(J-1)
@@ -4032,19 +4048,22 @@
 c      OPEN(UNIT=2,STATUS='OLD',SHARED,READONLY)
       DO 1 JMOL=1,MAXMOL
     1 CODE(JMOL)=0.
-      WRITE(6,10)
-   10 FORMAT(16H1MOLECULES INPUT)
+c      WRITE(6,10)
+c   10 FORMAT(16H1MOLECULES INPUT)
       DO 11 I=1,101
    11 IFEQUA(I)=0
 C     IF IFEQUA=1 AN EQUATION MUST BE SET UP FOR ELEMENT I
       KLOC=1
       LOCJ(1)=1
+      IF2LINE=0
       DO 20 JMOL=1,MAX1
       IF(KLOC.GT.MAXLOC)WRITE(6,199)
-      READ(2,13)C,E1,E2,E3,E4,E5,E6,E7
-   13 FORMAT(F18.2,F7.3,6E11.4)
+      IF2LINE=IF2LINE+1
+      CALL loadf2(IF2LINE,C,E1,E2,E3,E4,E5,E6,E7)
+c      READ(2,13)C,E1,E2,E3,E4,E5,E6,E7
+c   13 FORMAT(F18.2,F7.3,6E11.4)
       IF(C.EQ.0.)GO TO 23
-      WRITE(6,14)JMOL,C,E1,E2,E3,E4,E5,E6,E7
+c      WRITE(6,14)JMOL,C,E1,E2,E3,E4,E5,E6,E7
    14 FORMAT(I5,F18.2,F7.3,1P6E11.4)
       DO 15 II=1,8
       IF(C.GE.XCODE(II))GO TO 16
@@ -4098,11 +4117,11 @@
       DO 28 KLOC=1,NLOC
       ID=KCOMPS(KLOC)
    28 KCOMPS(KLOC)=IFEQUA(ID)
-      WRITE(6,29) NUMMOL,MAXMOL,NLOC,MAXLOC,NEQUA,MAXEQ
-   29 FORMAT(16H MOLECULES  USED,I4,5H  MAX,I4/
-     1       16H COMPONENTS USED,I4,5H  MAX,I4/
-     2       16H EQUATIONS  USED,I4,5H  MAX,I4)
-      CLOSE(UNIT=2)
+c      WRITE(6,29) NUMMOL,MAXMOL,NLOC,MAXLOC,NEQUA,MAXEQ
+c   29 FORMAT(16H MOLECULES  USED,I4,5H  MAX,I4/
+c     1       16H COMPONENTS USED,I4,5H  MAX,I4/
+c     2       16H EQUATIONS  USED,I4,5H  MAX,I4)
+c      CLOSE(UNIT=2)
       RETURN
       END
       SUBROUTINE NMOLEC
@@ -4376,18 +4395,18 @@
   109 CONTINUE
   110 CONTINUE
       IF(ITER.LT.NUMITS)GO TO 120
-      WRITE(6,112)(J,RHOX(J),T(J),P(J),XNE(J),XNATOM(J),RHO(J),
-     1J=1,NRHOX)
-  112 FORMAT(1H1,11X,4HRHOX,9X,1HT,11X,1HP,10X,3HXNE,8X,6HXNATOM,8X,
-     13HRHO/(I5,1P6E12.3))
+c      WRITE(6,112)(J,RHOX(J),T(J),P(J),XNE(J),XNATOM(J),RHO(J),
+c     1J=1,NRHOX)
+c  112 FORMAT(1H1,11X,4HRHOX,9X,1HT,11X,1HP,10X,3HXNE,8X,6HXNATOM,8X,
+c     13HRHO/(I5,1P6E12.3))
       NN=(NUMMOL/10)*10
       IF(NN.LT.NUMMOL)NN=NN+10
       DO 111 JMOL1=1,NN,10
-      JMOL10=JMOL1+9
-  111 WRITE(6,113)(CODE(JMOL),JMOL=JMOL1,JMOL10),(J,(XNMOL(J,JMOL),
-     1JMOL=JMOL1,JMOL10),J=1,NRHOX)
-  113 FORMAT(1H1,50X,26HMOLECULAR NUMBER DENSITIES/5X,10F12.2/
-     1(I5,1P10E12.3))
+  111 JMOL10=JMOL1+9
+c  111 WRITE(6,113)(CODE(JMOL),JMOL=JMOL1,JMOL10),(J,(XNMOL(J,JMOL),
+c     1JMOL=JMOL1,JMOL10),J=1,NRHOX)
+c  113 FORMAT(1H1,50X,26HMOLECULAR NUMBER DENSITIES/5X,10F12.2/
+c     1(I5,1P10E12.3))
   120 CONTINUE
       DO 125 K=2,NEQUA
       ID=IDEQUA(K)
@@ -4438,11 +4457,11 @@
       NN=(NUMMOL/10)*10
       IF(NN.LT.NUMMOL)NN=NN+10
       DO 151 JMOL1=1,NN,10
-      JMOL10=JMOL1+9
-  151 WRITE(6,153)(CODE(JMOL),JMOL=JMOL1,JMOL10),(J,(XNFPMOL(J,JMOL),
-     1JMOL=JMOL1,JMOL10),J=1,NRHOX)
-  153 FORMAT(1H1,40X,'MOLECULAR NUMBER DENSITIES / PARTITION FUNCTIONS'
-     1 /5X,10F12.2/(I5,1P10E12.3))
+  151 JMOL10=JMOL1+9
+c  151 WRITE(6,153)(CODE(JMOL),JMOL=JMOL1,JMOL10),(J,(XNFPMOL(J,JMOL),
+c     1JMOL=JMOL1,JMOL10),J=1,NRHOX)
+c  153 FORMAT(1H1,40X,'MOLECULAR NUMBER DENSITIES / PARTITION FUNCTIONS'
+c     1 /5X,10F12.2/(I5,1P10E12.3))
       RETURN
       END
       SUBROUTINE KAPP(N,NSTEPS,STEPWT)
