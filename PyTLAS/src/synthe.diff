--- /dev/fd/63	2025-11-25 18:06:06.362196481 -0500
+++ /dev/fd/62	2025-11-25 18:06:06.363196482 -0500
@@ -1,4 +1,4 @@
-      PROGRAM SYNTHE
+      SUBROUTINE SYNTHE
 c     revised 13jul15   molecule number increased, parameter mw=139, mw6=mw*6
 c     revised 11nov14   modified to agree with Fiorella Castelli's Linux version
 c                       including He I lines and reverting to her HPROF
@@ -101,13 +101,21 @@
       REAL*8 WL,E,EP,WLVAC,CENTER,CONCEN
 c      REAL*8 LABEL,LABELP,OTHER1,OTHER2
 	real*8 wavel
+
+      REAL*4, ALLOCATABLE :: FORT14(:,:)
+
 C
       FASTEX(X)=EXTAB(IFIX(X)+1)*
      1EXTABF(IFIX((X-FLOAT(IFIX(X)))*1000.+1.5))
-C
-      READ(93)NLINES,LENGTH,IFVAC,IFNLTE,N19,TURBV,DECKJ,IFPRED,
-     1     WLBEG,WLEND,RESOLU,RATIO,RATIOLG,CUTOFF,LINOUT
-      write(6,867)NLINES,LENGTH,LINOUT
+      N_F12=0
+      N_F19=0
+      N_F9=0
+C
+      CALL loadf93(NLINES,LENGTH,IFVAC,IFNLTE,N19,TURBV,DECKJ,IFPRED,
+     1     WLBEG,WLEND,RESOLU,RATIO,RATIOLG,CUTOFF,LINOUT)
+c      READ(93)NLINES,LENGTH,IFVAC,IFNLTE,N19,TURBV,DECKJ,IFPRED,
+c     1     WLBEG,WLEND,RESOLU,RATIO,RATIOLG,CUTOFF,LINOUT
+c      write(6,867)NLINES,LENGTH,LINOUT
  867  format(1x,'NLINES='I20,1x,'LENGTH=',I20,1x,'LINOUT=',I10)
       IXWLBEG=DLOG(WLBEG)/RATIOLG
       WBEGIN=DEXP(IXWLBEG*RATIOLG)
@@ -115,14 +123,14 @@
       IXWLBEG=IXWLBEG+1
       WBEGIN=DEXP(IXWLBEG*RATIOLG)
       ENDIF
-      CLOSE(93,STATUS='DELETE')
+      CLOSE(93)
 c      OPEN(10,STATUS='OLD',FORM='UNFORMATTED',ACTION='READ')
-      OPEN(UNIT=12,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
+c      OPEN(UNIT=12,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
 c      OPEN(UNIT=13,STATUS='NEW',FORM='UNFORMATTED')
-      OPEN(UNIT=13,FORM='UNFORMATTED')
-      OPEN(UNIT=14,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
-      OPEN(UNIT=19,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
-      OPEN(UNIT=20,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
+c      OPEN(UNIT=13,FORM='UNFORMATTED')
+c      OPEN(UNIT=14,FORM='UNFORMATTED',ACCESS='APPEND')
+c      OPEN(UNIT=19,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
+c      OPEN(UNIT=20,STATUS='OLD',FORM='UNFORMATTED',ACCESS='APPEND')
       IF(LINOUT.LT.0.)GO TO 3442
       IF(N19.GT.0)THEN
       REWIND 20
@@ -131,24 +139,26 @@
       READ(20)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
      1 LINDAT4I,REF,LINDAT4II         
 c 3440 WRITE(13)LINDAT8,LINDAT4
- 3440 WRITE(13)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
-     1 LINDAT4I,REF,LINDAT4II
+c 3440 WRITE(13)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
+ 3440 CONTINUE
+c     1 LINDAT4I,REF,LINDAT4II
       ENDIF
       IF(NLINES.GT.0)THEN
       REWIND 14
       DO 3441 I=1,NLINES
 c      READ(14)LINDAT8,LINDAT4
-      READ(14)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
-     1 LINDAT4I,REF,LINDAT4II         
+c      READ(14)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
+c     1 LINDAT4I,REF,LINDAT4II         
 c 3441 WRITE(13)LINDAT8,LINDAT4
- 3441 WRITE(13)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
-     1 LINDAT4I,REF,LINDAT4II
+c 3441 WRITE(13)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
+ 3441 CONTINUE
+c     1 LINDAT4I,REF,LINDAT4II
       ENDIF
  3442 CLOSE(UNIT=20)
       CLOSE(UNIT=14)
 c     OPEN(UNIT=14,TYPE='NEW',FORM='UNFORMATTED',RECORDTYPE='FIXED',
 c     1ACCESS='DIRECT',BLOCKSIZE=LENREC*4,RECORDSIZE=LENREC)
-      OPEN(UNIT=14,FORM='UNFORMATTED', ACCESS='DIRECT', RECL=LENREC*4)
+c      OPEN(UNIT=14,FORM='UNFORMATTED', ACCESS='DIRECT', RECL=LENREC*4)
 C
       DO 3456 I=1,1001
       EXTAB(I)=EXP(-FLOAT(I-1))
@@ -161,13 +171,16 @@
       CALL TABVOIGT(VSTEPS,2001)
 C
 
-      READ(10)NRHOX,TEFF,GLOG,TITLE
-      WRITE(6,2000)TEFF,GLOG,TITLE
+      CALL loadf10_1(NRHOX,TEFF,GLOG,NEDGE,FRQEDG,WLEDGE,CMEDGE,IDMOL,
+     1MOMASS,NCON,CONFRQ,QT,QTKEV,QTK,QHKT,QTLOG,QHCKT,QP,QXNE,QXNATOM,
+     2QRHO,QRHOX,QVTURB,QXNFH,QXNFHE,QXNFH2)
+c      READ(10)
+      ALLOCATE(FORT14(NRHOX, LENREC))
+c      WRITE(6,2000)TEFF,GLOG,TITLE
  2000 FORMAT(6H TEFF=,F10.1,3X,5HGRAV=,F6.3,3X,74A1)
-      READ(10)NEDGE,(FRQEDG(IEDGE),WLEDGE(IEDGE),CMEDGE(IEDGE),
-     1     IEDGE=1,NEDGE),IDMOL,MOMASS
-      READ(10)NCON,(CONFRQ(NU),NU=1,NCON)
-      write(6,666)ncon
+c      READ(10)
+c      READ(10)
+c      write(6,666)ncon
  666  format(i10)
       WLEDGE(1)=ABS(WLEDGE(1))
       DO 2001 IEDGE=2,NEDGE
@@ -179,8 +192,7 @@
 C     READ(10)T,TKEV,TK,HKT,TLOG,HCKT,P,XNE,XNATOM,RHO,RHOX,VTURB,
 C    1XNFH,XNFHE,XNFH2
 C     ON VAX VARIABLES ARE READ REAL*8 AND CONVERTED TO REAL*4
-      READ(10)QT,QTKEV,QTK,QHKT,QTLOG,QHCKT,QP,QXNE,QXNATOM,QRHO,
-     1QRHOX,QVTURB,QXNFH,QXNFHE,QXNFH2
+c      READ(10)
       DO 2010 J=1,NRHOX
       T(J)=QT(J)
       TKEV(J)=QTKEV(J)
@@ -204,23 +216,26 @@
       HFIELD(J)=DECKJ(2,J)
  2011 CONTINUE
 C
-      WRITE(9)WLBEG,RESOLU,WLEND,LENGTH,NRHOX,LINOUT,TURBV,IFVAC
-      WRITE(9)NEDGE,(FRQEDG(IEDGE),WLEDGE(IEDGE),CMEDGE(IEDGE),
-     1IEDGE=1,NEDGE),IDMOL,MOMASS
+c      WRITE(9)WLBEG,RESOLU,WLEND,LENGTH,NRHOX,LINOUT,TURBV,IFVAC
+c      WRITE(9)NEDGE,(FRQEDG(IEDGE),WLEDGE(IEDGE),CMEDGE(IEDGE),
+c     1IEDGE=1,NEDGE),IDMOL,MOMASS
 C
       ILINES=0
       N12=NLINES
       NLINES=NLINES+N19
       IREC=0
 C
+
       DO 500 J=1,NRHOX
-      REWIND 12
+c      REWIND 12
+      N_F12=0
 C     INITIALIZE BUFFER
       DO 210 NBUFF=1,LENGTH
   210 BUFFER(NBUFF)=0.
-      READ(10)QABLOG
-      READ(10)
-      READ(10)
+      CALL loadf10_2(J,QABLOG,QXNFPEL,QDOPPLE)
+c      READ(10)
+c      READ(10)
+c      READ(10)
       NU=0
       DO 2002 IEDGE=1,NEDGE-1
       NU=NU+1
@@ -243,7 +258,7 @@
       DO 2006 NBUFF=1,LENGTH
  2006 CONTINUUM(NBUFF)=10.**CONTINUUM(NBUFF)
 C     
-      READ(10)QXNFPEL,QDOPPLE
+c      READ(10)
 C      IF(IFTP(J).EQ.0)GO TO 400
       XNFPH(J,1)=QXNFPEL(1)
       XNFPH(J,2)=QXNFPEL(2)
@@ -269,7 +284,7 @@
 C
 C     DOPPLER SHIFT IN POINT NUMBERS
       NVSHIFT=RESOLU*VELSHIFT(J)/299792.458D0+.5D0
-      WRITE(6,215)J,VELSHIFT(J),NVSHIFT
+c      WRITE(6,215)J,VELSHIFT(J),NVSHIFT
   215 FORMAT(I5,'  VELOCITY SHIFT',F9.3,I7)
 C     ADD LINES TO BUFFER
       MLINES=0
@@ -277,7 +292,9 @@
       IF(N12.EQ.0)GO TO 400
       N191=N19+1
       DO 350 ILINE=N191,NLINES
-      READ(12)NBUFF,CONGF,NELION,ELO,GAMRF,GAMSF,GAMWF,alpha
+c      READ(12)NBUFF,CONGF,NELION,ELO,GAMRF,GAMSF,GAMWF,alpha
+      N_F12 = N_F12 + 1
+      CALL loadf12(N_F12,NBUFF,CONGF,NELION,ELO,GAMRF,GAMSF,GAMWF,alpha)
 c      if(alpha.ne.0.0)write(6,1788)nbuff,nelion,alpha
  1788 format(2I10,'alpha=',f10.3)
       QCONGF=CONGF
@@ -296,12 +313,12 @@
       WAVEl=WBEGIN*RATIO**(NBUFF-1)
 	nelem=int(nelion/6)+1
 	v2=(1.-alpha)/2
-	write(6,1789)wavel,nelem,alpha,v2
+c	write(6,1789)wavel,nelem,alpha,v2
  1789   format(f10.3,i10,'alpha=',2f10.2)
 	hfactor(j)=(t(j)/10000.)**v2
 	hefactor(j)=0.628*(2.0991D-4*T(j)*(0.25+1.008/atmass(nelem)))**v2
 	h2factor(j)=1.08*(2.0991D-4*T(j)*(0.5+1.008/atmass(nelem)))**v2
-	if(j.eq.1)write(6,1799)hfactor(j),hefactor(j),h2factor(j)
+c	if(j.eq.1)write(6,1799)hfactor(j),hefactor(j),h2factor(j)
  1799   format('hfactor',1p3E10.4)
 	txnxn(j)=xnfh(j)*hfactor(j)+xnfhe(J,1)*hefactor(j)+xnfh2(j)*h2factor(j)
 	endif
@@ -364,23 +381,26 @@
       DO 26 NBEG=1,LENGTH,LENREC
       IREC=IREC+1
       NEND=NBEG+LENREC-1
-      WRITE(14,REC=IREC)(BUFFER(I),I=NBEG,NEND)
+c      WRITE(14,REC=IREC)(BUFFER(I),I=NBEG,NEND)
+      FORT14(IREC,:)=BUFFER(NBEG:NEND)
    26 CONTINUE
-      WRITE(6,499)J,MLINES
+c      WRITE(6,499)J,MLINES
   499 FORMAT(30X,2I10,' LINES USED')
       MLINEJ(J)=MLINES
       ILINES=ILINES+MLINES
   500 CONTINUE
-      WRITE(6,106)ILINES
+      CLOSE(242)
+c      WRITE(6,106)ILINES
   106 FORMAT(I10)
 C
 C     DIRECT IO TRANSPOSITION
       N9=0
       DO 99 N=1,NUMREC
-      WRITE(6,106)N
+c      WRITE(6,106)N
       DO 93 J=1,NRHOX
       IREC=J*NUMREC-NUMREC+N
-      READ(14,REC=IREC)(TRANSP(J,I),I=1,LENREC)
+c      READ(14,REC=IREC)(TRANSP(J,I),I=1,LENREC)
+      TRANSP(J,1:LENREC)=FORT14(IREC,:)
    93 CONTINUE
       NOUT=LENREC
       LASTREC=LENGTH-NUMREC*LENREC+LENREC
@@ -391,15 +411,17 @@
       FREQ=2.99792458D17/WAVE
       DO 94 J=1,NRHOX
    94 ASYNTH(J)=TRANSP(J,I)*(1.-EXP(-FREQ*HKT(J)))
-   95 WRITE(9)ASYNTH
+C      WRITE(9)ASYNTH
+      N_F9=N_F9+1
+   95 CALL update_asynth(N_F9,ASYNTH)
    99 CONTINUE
 C      N9=LENGTH IS A CHECK THAT THE TRANSPOSITION WORKED PROPERLY
-      WRITE(6,96)N9
+c      WRITE(6,96)N9
    96 FORMAT(I10,27H OPACITY VECTORS ON TAPE 9 )
 C
 C     SAVE ALL LINES USED
       N9=0
-      WRITE(6,8030)NLINES,LINOUT
+c      WRITE(6,8030)NLINES,LINOUT
  8030 FORMAT(1x,'NLINES=',I20,1x,'LINOUT=',I10)
       IF(NLINES.EQ.0)GO TO 810
       IF(LINOUT.LT.0)GO TO 810
@@ -426,21 +448,22 @@
       N9=N9+1
       LINE(I)=N9
   809 CONTINUE
- 810  WRITE(6,1066)N9
+  810 CONTINUE
+c 810  WRITE(6,1066)N9
  1066 format(1x,'N9=',I10)
-      WRITE(8)N9
-      WRITE(9)N9
-      CLOSE(12,STATUS='DELETE')
-      CLOSE(13,STATUS='DELETE')
+c      WRITE(8)N9
+c      WRITE(9)N9
+      CLOSE(12)
+      CLOSE(13)
 C
 C     SET UP LINE CENTER OPACITY FOR EACH LINE
-      IF(ILINES.EQ.0)CALL EXIT
-      IF(LINOUT.LT.0)CALL EXIT
+      IF(ILINES.EQ.0)RETURN
+      IF(LINOUT.LT.0)RETURN
       REWIND 15
       IREC=0
       DO 830 J=1,NRHOX
       MAXLINE=MLINEJ(J)
-      WRITE(6,817)J,MAXLINE
+c      WRITE(6,817)J,MAXLINE
   817 FORMAT('J='I10,'MAXLINE=',2I10)
       K=0
       JOUT=0
@@ -487,11 +510,12 @@
       IREC=IREC+1
       WRITE(14,REC=IREC)RECORD
       K=0
-  830 WRITE(6,817)J,MAXLINE,JOUT
+c  830 WRITE(6,817)J,MAXLINE,JOUT
+  830 CONTINUE
 C
 C     TRANSPOSE
       IF(N9.LE.MAXLIN)GO TO 808
-      WRITE(6,877)
+c      WRITE(6,877)
   877 FORMAT(28H TOO MANY LINES TO TRANSPOSE)
       call exit
   808 CONTINUE
@@ -500,10 +524,11 @@
       NLAST=N9-NUMREC*LENREC+LENREC
       NCEN=0
       DO 899 N=1,NUMREC
-      WRITE(6,106)N
+c      WRITE(6,106)N
       DO 893 J=1,NRHOX
       IREC=J*NUMREC-NUMREC+N
-      READ(14,REC=IREC)(TRANSP(J,I),I=1,LENREC)
+c      READ(14,REC=IREC)(TRANSP(J,I),I=1,LENREC)
+      TRANSP(J,1:LENREC)=FORT14(IREC,:)
   893 CONTINUE
       NOUT=LENREC
       IF(N.EQ.NUMREC)NOUT=NLAST
@@ -516,14 +541,15 @@
       DO 897 J=1,NRHOX
   897 ALINEC(J)=TRANSP(J,I)*(1.-EXP(-FREQ*HKT(J)))
 C  895 WRITE(9)LINDAT8,LINDAT4,ALINEC
- 895  WRITE(9)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
-     1 LINDAT4I,REF,LINDAT4II,ALINEC
+  895 CONTINUE
+c 895  WRITE(9)LINDAT8I,LABEL,LABELP,OTHER1,OTHER2,LINDAT8II,
+c     1 LINDAT4I,REF,LINDAT4II,ALINEC
   899 CONTINUE
-      CLOSE(7,STATUS='DELETE')
-      CLOSE(15,STATUS='DELETE')
-      CLOSE(14,STATUS='DELETE')
+      CLOSE(7)
+      CLOSE(15)
+      CLOSE(14)
 c      WRITE(6,96)NCEN
-      CALL EXIT
+      RETURN
       END
       SUBROUTINE XLINOP(J,N19,CUTOFF,VELSHIFT,IFVAC,LINOUT)
 c      PARAMETER (kw=99)
@@ -609,7 +635,7 @@
     1 EHYD(N)=109678.764D0-109677.576D0/N**2
       DO 2 N=1,99
     2 ALPHAHYD(N)=1.D7/(EHYD(N+1)-EHYD(N))
-      WRITE(6,90)
+c      WRITE(6,90)
    90 FORMAT('       NMERGE    EMERGE    EMERGEH')
       DO 91 K=1,NRHOX
 C     FOR NEUTRALS  FOR IONS NSTARK=NSTARK*Z**.25  NDOPP=NDOPP*Z**(2./3.)
@@ -621,7 +647,8 @@
       NMERGE=INGLIS-1.5
       EMERGE(K)=109737.312D0/NMERGE**2
       EMERGEH(K)=109677.576D0/NMERGE**2
-   91 WRITE(6,92)K,NMERGE,EMERGE(K),EMERGEH(K)
+   91 CONTINUE
+c   91 WRITE(6,92)K,NMERGE,EMERGE(K),EMERGEH(K)
    92 FORMAT(I3,4F10.3)
       ITEMP1=ITEMP
 C
@@ -631,9 +658,11 @@
       OLDELOH=1.E30*FLOAT(J*ITEMP)
       DOPRATIO=1.D0+VELSHIFT/299792.458D0
       REWIND 19
+      N_F19=0
       DO 900 ILINE=1,N19
-      READ(19)WL,ELO,GF,NBLO,NBUP,NELION,TYPE,NCON,NELIONX,
-     1GAMMAR,GAMMAS,GAMMAW,alpha,NBUFF
+      N_F19 = N_F19 + 1
+      CALL loadf19(N_F19,WL,ELO,GF,NBLO,NBUP,NELION,TYPE,NCON,NELIONX,
+     1GAMMAR,GAMMAS,GAMMAW,alpha,NBUFF)
 c      READ(19)WL,ELO,GF,NBLO,NBUP,NELION,TYPE,NCON,NELIONX,
 c     1GAMMAR,GAMMAS,GAMMAW,alpha,NBUFF,LIM
 c      write(6,816)iline,wl,elo,gf,alpha
